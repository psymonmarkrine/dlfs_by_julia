# 5章 誤差逆伝搬

前章では、ニューラルネットワークの学習について説明しました。  
～  

## 5.1 計算グラフ
### 5.1.1 計算グラフで解く
### 5.1.2 局所的な計算
### 5.1.3 なぜ計算グラフで解くのか？
## 5.2 連鎖率
### 5.2.1 計算グラフの逆伝搬
### 5.2.3 連鎖率と計算グラフ
## 5.3 逆伝搬
### 5.3.1 加算ノードの逆伝搬
### 5.3.2 乗算ノードの逆伝搬
### 5.3.3 リンゴの例
## 5.4 単純なレイヤの実装
### 5.4.1 乗算レイヤの実装

～  

```julia
mutable struct MulLayer
    x
    y
end

function MulLayer()
    return MulLayer(nothing, nothing)
end

function forward(self::MulLayer, x, y)
    self.x = x
    self.y = y                
    out = x * y

    return out
end

function backward(self::MulLayer, dout)
    dx = dout * self.y # xとyをひっくり返す
    dy = dout * self.x

    return dx, dy
end
```

```julia
apple = 100
apple_num = 2
tax = 1.1

# layer
mul_apple_layer = MulLayer()
mul_tax_layer = MulLayer()

# forward
apple_price = forward(mul_apple_layer, apple, apple_num)
price = forward(mul_tax_layer, apple_price, tax)

print(price) # 220.00000000000003
```

～  

```julia
# backward
dprice = 1
dapple_price, dtax = backward(mul_tax_layer, dprice)
dapple, dapple_num = backward(mul_apple_layer, dapple_price)

print("$dapple, $dapple_num, $dtax") # 2.2, 110.00000000000001, 200
```

### 5.4.2 加算レイヤの実装

～  

```julia
abstract type AddLayer end

function forward(self::AddLayer, x, y)
    out = x + y

    return out
end

function backward(self::AddLayer, dout)
    dx = dout * 1
    dy = dout * 1

    return dx, dy
end
```

～  

```julia
apple = 100
apple_num = 2
orange = 150
orange_num = 3
tax = 1.1

# layer
mul_apple_layer = MulLayer()
mul_orange_layer = MulLayer()
add_apple_orange_layer = AddLayer()
mul_tax_layer = MulLayer()

# forward
apple_price = forward(mul_apple_layer, apple, apple_num)  # (1)
orange_price = forward(mul_orange_layer, orange, orange_num)  # (2)
all_price = forward(add_apple_orange_layer, apple_price, orange_price)  # (3)
price = forward(mul_tax_layer, all_price, tax)  # (4)

# backward
dprice = 1
dall_price, dtax = backward(mul_tax_layer, dprice)  # (4)
dapple_price, dorange_price = backward(add_apple_orange_layer, dall_price)  # (3)
dorange, dorange_num = backward(mul_orange_layer, dorange_price)  # (2)
dapple, dapple_num = backward(mul_apple_layer, dapple_price)  # (1)

print(price) # 715.0000000000001
print(dapple_num, dapple, dorange, dorange_num, dtax) # 110.00000000000001 2.2 3.3000000000000003 165.0 650
```

## 5.5 活性化関数レイヤの実装
